generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
}

enum Role { 
  ENGINEER 
  APPROVER 
  ADMIN 
}

enum Env { 
  DEV 
  STAGE 
  PROD 
}

enum RequestStatus { 
  DRAFT 
  PLANNED 
  APPROVED 
}

model User {
  id      String     @id @default(cuid())
  email   String     @unique
  name    String
  role    Role       @default(ENGINEER)
  createdAt DateTime @default(now())
  requests Request[]
}

model Template {
  id           String @id @default(cuid())
  key          String @unique
  name         String
  version      Int    @default(1)
  paramsSchema Json
  createdAt    DateTime @default(now())
  requests     Request[]
}

model Request {
  id          String        @id @default(cuid())
  templateId  String
  template    Template      @relation(fields: [templateId], references: [id])
  env         Env
  params      Json
  status      RequestStatus @default(DRAFT)
  createdById String
  createdBy   User          @relation(fields: [createdById], references: [id])
  createdAt   DateTime      @default(now())
}